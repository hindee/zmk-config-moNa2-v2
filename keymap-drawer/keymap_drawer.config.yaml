# =============================================================================
# keymap-drawer.config.yaml for moNa2
# - Supports rotary encoder & trackball
# - SVG glyphs embedded directly (keymap-drawer limitation)
# - CSS and structure refactored for readability
# =============================================================================

draw_config:
  # ---------------------------------------------------------------------------
  # Layout & geometry
  # ---------------------------------------------------------------------------
  n_columns: 1
  draw_key_sides: true
  append_colon_to_layer_header: true
  small_pad: 4.0

  key_w: 60.0
  key_h: 56.0
  split_gap: 30.0

  combo_w: 28.0
  combo_h: 26.0

  key_rx: 9.0
  key_ry: 9.0

  inner_pad_w: 0.5
  inner_pad_h: 0.2
  outer_pad_w: 56.0
  outer_pad_h: 56.0

  line_spacing: 1.2
  arc_radius: 10.0

  # ---------------------------------------------------------------------------
  # Key side rendering
  # ---------------------------------------------------------------------------
  key_side_pars:
    rel_x: 0
    rel_y: 1
    rel_w: 10
    rel_h: 8
    rx: 2
    ry: 2

  # ---------------------------------------------------------------------------
  # CSS styling
  # ---------------------------------------------------------------------------
  svg_extra_style: |
    /* =========================================================================
       Global theme
       ========================================================================= */
    svg.keymap {
      background-color: #444444 !important;
      font-family: Ubuntu Mono, Inconsolata, Consolas, Liberation Mono, Menlo, monospace;
      font-size: 14px;
      font-weight: bold;
      text-rendering: optimizeLegibility;
    }
    text { fill: #000000; }

    rect.key {
      fill: #FFFFFF;
      stroke: #F9F9F9 !important;
      stroke-width: 2.0;
    }

    rect.held, rect.combo.held {
      fill: #4FBF8F !important;
      stroke: #93BF49 !important;
      stroke-width: 2.0;
    }

    /* =========================================================================
       Highlighted thumb cluster (keypos 37–41)
       ========================================================================= */
    .keypos-37 text,
    .keypos-38 text,
    .keypos-39 text,
    .keypos-40 text,
    .keypos-41 text {
      fill: #000000 !important;
      font-weight: bold;
      font-size: 13px;
      text-anchor: middle !important;
      dominant-baseline: middle !important;
      stroke: none !important;
    }

    .keypos-37 rect.key,
    .keypos-38 rect.key,
    .keypos-39 rect.key,
    .keypos-40 rect.key,
    .keypos-41 rect.key {
      fill: #D3FF89 !important;
      stroke: #C3EF79 !important;
      stroke-width: 2.0;
    }

    /* =========================================================================
       Trackball (keypos-42)
       ========================================================================= */
    .keypos-42 rect.key,
    .keypos-42 rect.key_side {
      display: none !important;
    }
    .keypos-42 use[href="#trackball"] {
      width: 185px !important;
      height: 158px !important;
      x: 5px !important;
      y: -45px !important;
      transform: translate(-8px, 30px) scale(1.8) !important;
    }
    .keypos-42 text.hold {
      fill: #000000 !important;
      font-size: 12px !important;
      font-weight: bold !important;
      transform: translate(45px, -17px) !important;
      pointer-events: none;
    }

    /* =========================================================================
       Rotary encoder (keypos-15)
       ========================================================================= */
    .keypos-15 rect.key,
    .keypos-15 rect.key_side {
      display: none !important;
    }
    .keypos-15 use[href="#rotaryencoder"] {
      x: -30px !important;
      y: -37px !important; /* ← 元より3px下げた */
      width: 58px !important;
      height: 54px !important;
      transform: scale(0.8) !important;
    }
    .keypos-15 text.hold {
      fill: #000000 !important;
      font-size: 12px !important;
      font-weight: bold !important;
      transform: translateY(-26px) !important;
      pointer-events: none;
    }

  # ---------------------------------------------------------------------------
  # Legend settings
  # ---------------------------------------------------------------------------
  legend_font_size: 12
  legend_hold_font_size: 10
  legend_shifted_font_size: 10

  legend_tap_offset_y: -6
  legend_hold_offset_y: 10
  legend_shifted_offset_y: 4

  legend_max_width_ratio: 0.9
  legend_max_height_ratio: 0.35
  legend_line_spacing: 1.1

  combo_legend_font_size: 10
  combo_legend_offset_y: 0
  combo_legend_max_width_ratio: 0.9
  combo_legend_max_height_ratio: 0.5
  combo_legend_line_spacing: 1.0

  # ---------------------------------------------------------------------------
  # Glyph settings
  # ---------------------------------------------------------------------------
  glyph_font_size: 20
  glyph_hold_font_size: 16
  glyph_shifted_font_size: 16

  glyph_tap_offset_y: -4
  glyph_hold_offset_y: 6
  glyph_shifted_offset_y: 2

  glyph_max_width_ratio: 2.0
  glyph_max_height_ratio: 2.0
  glyph_line_spacing: 1.1

  shrink_wide_legends: 5

  glyph_tap_size: 60
  glyph_hold_size: 60
  glyph_shifted_size: 15

  # ---------------------------------------------------------------------------
  # Embedded SVG glyphs (整形済み)
  # ---------------------------------------------------------------------------
  glyphs:
    trackball: |
      <svg xmlns="http://www.w3.org/2000/svg" width="158" height="114" viewBox="-0.5 -0.5 158 114">
        <defs>
          <!-- Green gradient (ball) -->
          <linearGradient id="tb-g1" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#33CC33"/>
            <stop offset="100%" stop-color="#B3FF66"/>
          </linearGradient>

          <!-- Light gray gradient (outer right shape) -->
          <linearGradient id="tb-g2" x1="100%" y1="0%" x2="0%" y2="0%">
            <stop offset="0%" stop-color="#DADADA"/>
            <stop offset="100%" stop-color="#FDFDFD"/>
          </linearGradient>

          <!-- White gradient A (inner left shape) -->
          <linearGradient id="tb-g3" x1="0%" y1="100%" x2="0%" y2="0%">
            <stop offset="0%" stop-color="#DADADA"/>
            <stop offset="100%" stop-color="#FFFFFF"/>
          </linearGradient>

          <!-- White gradient B (inner right shape) -->
          <linearGradient id="tb-g4" x1="100%" y1="0%" x2="0%" y2="0%">
            <stop offset="0%" stop-color="#DADADA"/>
            <stop offset="100%" stop-color="#FFFFFF"/>
          </linearGradient>
        </defs>

        <g>
        <!-- Green ball -->
          <ellipse cx="56" cy="56" rx="40" ry="40"
            fill="url(#tb-g1)"
            transform="rotate(225,56,56)"/>

          <!-- Right outer shape -->
          <path d="M 101 21 L 141 21 L 161 37 L 161 91 L 81 91 L 81 37 Z"
            fill="url(#tb-g2)"
            stroke="#fcfcfc"
            transform="rotate(90,121,56)"/>

          <!-- Left inner curved shape -->
          <path d="M 87 15 L 107 15 Q 67 55 107 95 L 87 95 Q 47 55 87 15 Z"
            fill="url(#tb-g3)"/>

          <!-- Right inner rectangle -->
          <path d="M 86 26 L 126 26 L 126 86 L 86 86 Z"
            fill="url(#tb-g4)"
            transform="rotate(90,106,56)"/>
        </g>
      </svg>

    rotaryencoder: |
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="-0.5 -0.5 60 60">
        <defs>
          <radialGradient id="wheelgrad" cx="50%" cy="50%" r="60%">
            <stop offset="0%" stop-color="#FAFAFA"/>
            <stop offset="70%" stop-color="#F0F0F0"/>
            <stop offset="100%" stop-color="#E8E8E8"/>
          </radialGradient>
        </defs>

        <circle cx="30" cy="30" r="29.5"
          fill="url(#wheelgrad)"
          stroke="#D8D8D8"
          stroke-width="0.5"/>

        <g stroke="#C8C8C8" stroke-width="1.3" stroke-linecap="round">
          {% for deg in range(0, 360, 15) %}
          <line transform="rotate({{deg}} 30 30)" x1="30" y1="0" x2="32.12" y2="2.12"/>
          {% endfor %}
        </g>
      </svg>

  # External glyph providers
  glyph_urls:
    tabler: https://unpkg.com/@tabler/icons/icons/outline/{}.svg
    tablerf: https://unpkg.com/@tabler/icons/icons/filled/{}.svg
    mdi: https://raw.githubusercontent.com/Templarian/MaterialDesign-SVG/master/svg/{}.svg
    mdil: https://raw.githubusercontent.com/Pictogrammers/MaterialDesignLight/master/svg/{}.svg
    material: https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/{}/default/48px.svg
  use_local_cache: true

# =============================================================================
# Parse configuration
# =============================================================================

parse_config:
  preprocess: true
  skip_binding_parsing: false

  sticky_label: sticky
  toggle_label: $$mdi:toggle-switch$$

  trans_legend:
    t: ▽
    type: trans

  # ---------------------------------------------------------------------------
  # ZMK keycode → legend mapping (JIS-friendly)
  # ---------------------------------------------------------------------------
  zmk_keycode_map:
    EXCLAMATION: '!'
    AT: '"'
    HASH: '#'
    DOLLAR: '$'
    PERCENT: '%'
    CARET: '&'
    AMPERSAND: "'"
    ASTERISK: '('
    LEFT_PARENTHESIS: ')'
    RIGHT_PARENTHESIS: '('
    EQUAL: '^'
    PLUS: '~'
    MINUS: '-'
    UNDERSCORE: '='
    SLASH: '/'
    QUESTION: '?'
    BACKSLASH: ']'
    PIPE: '}'
    SEMICOLON: ';'
    COLON: '+'
    DOUBLE_QUOTES: '*'
    SINGLE_QUOTE: ':'
    COMMA: ','
    PERIOD: '.'
    LESS_THAN: '<'
    GREATER_THAN: '>'
    LEFT_BRACKET: '@'
    RIGHT_BRACKET: '['
    LEFT_BRACE: '`'
    RIGHT_BRACE: '{'
    GRAVE: '半/全'
    TILDE: '~'
    SPACE: '␣'
    BACKSPACE: '⌫'
    ENTER: '⏎'
    TAB: '⇥'
    ESCAPE: '⎋'
    LSHIFT: '⇧'
    RSHIFT: '⇧'
    LCTRL: 'Ctrl'
    RCTRL: 'Ctrl'
    LEFT_ALT: 'Alt'
    RIGHT_ALT: 'Alt'
    LGUI: '⌘'
    RGUI: '⌘'
    UP_ARROW: '↑'
    DOWN_ARROW: '↓'
    LEFT_ARROW: '←'
    RIGHT_ARROW: '→'
    YEN_PIP: '¥'
    YEN_UNS: '¥'
    JP_YEN: '¥'
    JP_PIP: '|'
    JP_UNS: '_'
    JPY: '¥'
    JIS_YEN: '¥'
    JIS_PIPE: '|'
    JIS_UNDERSCORE: '_'
    '0x89': '¥'
    'LS(0x89)': '|'
    'LS(0x87)': '_'
    INSERT: 'INS'
    'LG(LA(K))': 'MIC'
    LEFT_WIN: '⌘'

  # ---------------------------------------------------------------------------
  # Raw bindings (trackball & rotary encoder)
  # ---------------------------------------------------------------------------
  raw_binding_map:
    '&kp_exit_AML RIGHT_SHIFT': { tap: '/', hold: '⇧' }
    '&kp_exit_AML INT_MUHENKAN': { tap: '無変換', hold: 'ALT' }
    '&kp_exit_AML Z': { tap: 'Z', hold: '⇧' }

    # Trackball
    '&TB_none':   { tap: '$$trackball$$' }
    '&TB_mouse':  { tap: '$$trackball$$', hold: 'Pointing' }
    '&TB_scroll': { tap: '$$trackball$$', hold: 'Scroll' }

    # Rotary encoder
    '&RE_scroll':  { tap: '$$rotaryencoder$$', hold: '↑↓' }
    '&RE_alttab':  { tap: '$$rotaryencoder$$', hold: 'AltTab' }
    '&RE_volume':  { tap: '$$rotaryencoder$$', hold: 'Volume' }
    '&RE_ctltab':  { tap: '$$rotaryencoder$$', hold: 'CtlTab' }
    '&RE_sidesc':  { tap: '$$rotaryencoder$$', hold: '←→' }
